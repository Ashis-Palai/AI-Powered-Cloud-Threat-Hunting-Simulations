title: Azure Storage Data Plane Enumeration via Managed Identity
id: 8c5e3b41-7f92-4e1a-a9d4-azure-storage-enumeration-managed-identity
status: experimental
description: >
  Detects Azure Storage data plane enumeration or access performed using OAuth
  authentication backed by a Managed Identity. The rule identifies successful
  container or blob listing operations commonly used by attackers to validate
  access and assess data exposure after obtaining cloud credentials through
  IMDS abuse or other compromise paths.

author: Cloud Threat Hunting / Purple Team
date: 2026-01-08

references:
  - https://attack.mitre.org/techniques/T1530/
  - https://attack.mitre.org/techniques/T1020/
  - https://attack.mitre.org/techniques/T1526/
  - https://learn.microsoft.com/azure/storage/blobs/storage-blob-logging
  - https://learn.microsoft.com/azure/storage/common/storage-authentication-methods

logsource:
  product: azure
  service: storage
  category: blob

detection:

  # Successful storage data plane access
  storage_success:
    StatusCode: "200"
    AuthenticationType: OAuth
    ServiceType: Blob

  # Discovery-oriented storage operations
  storage_discovery_operations:
    OperationName:
      - ListContainers
      - ListBlobs
      - GetContainerProperties
      - GetBlobProperties

  # Managed Identityâ€“backed access (non-human identity)
  managed_identity_context:
    RequesterUpn: null
    RequesterAudience|contains:
      - storage.azure.com

  # RBAC-backed authorization (not SAS or account key)
  rbac_authorization:
    AuthorizationDetails.AuthorizationType: RBAC

  # Non-application or attacker-style tooling
  suspicious_user_agent:
    UserAgentHeader|contains:
      - curl
      - wget
      - python
      - powershell
      - httpclient

  condition: >
    storage_success
    and storage_discovery_operations
    and managed_identity_context
    and rbac_authorization
    and suspicious_user_agent

falsepositives:
  - Legitimate automation using managed identities for inventory or backups
  - Cloud security posture management or compliance scanning tools
  - Authorized data access by DevOps or SRE workflows

level: critical

tags:
  - attack.exfiltration
  - attack.discovery
  - attack.collection
  - attack.t1530
  - attack.t1020
  - attack.t1526
  - azure
  - storage
  - managed_identity
