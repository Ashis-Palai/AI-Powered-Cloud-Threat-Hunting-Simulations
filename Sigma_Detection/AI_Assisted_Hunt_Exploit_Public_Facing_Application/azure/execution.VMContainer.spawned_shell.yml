title: Azure VM / Container â€“ Web Service Spawned Interactive Shell or Interpreter
id: 9a4f2d6b-ec71-4c89-b8a2-vmcontainer-spawned-shell
status: experimental
description: >
  Detects post-web exploitation execution on Azure virtual machines or
  containerized workloads where a web-facing service spawns an interactive
  shell or scripting interpreter. This behavior is strongly associated with
  reverse shells, web shells, and container escape preparation following the
  exploitation of a public-facing application.

author: Cloud Threat Hunting / Purple Team
date: 2026-01-08

references:
  - https://attack.mitre.org/techniques/T1059/006/
  - https://attack.mitre.org/techniques/T1071/001/
  - https://attack.mitre.org/techniques/T1033/
  - https://attack.mitre.org/techniques/T1082/
  - https://attack.mitre.org/techniques/T1611/
  - https://learn.microsoft.com/microsoft-365/security/defender/advanced-hunting-deviceprocessevents

logsource:
  product: azure
  service: defender_for_endpoint
  category: process_creation

detection:

  # Web-facing services commonly exploited for initial access
  web_service_parent:
    InitiatingProcessParentFileName|contains:
      - php-fpm
      - apache
      - httpd
      - nginx
      - tomcat
      - node
      - gunicorn

  # Shells and interpreters used after exploitation
  spawned_shell_or_interpreter:
    FileName:
      - sh
      - bash
      - dash
      - zsh
      - python
      - python3
      - perl
      - ruby
      - node

  # Reverse shell, interactive shell, or execution intent
  suspicious_commandline:
    ProcessCommandLine|contains:
      - socket
      - pty.spawn
      - dup2
      - /bin/sh
      - whoami
      - /etc/passwd
      - mount
      - env
      - curl
      - wget
      - docker.sock
      - /var/run/docker.sock

  # Interpreter spawning a shell (classic reverse shell pattern)
  interpreter_to_shell_chain:
    InitiatingProcessFileName:
      - python
      - python3
      - perl
      - ruby
    FileName:
      - sh
      - bash

  # Containerized or interactive execution context
  container_or_interactive_context:
    AdditionalFields|contains:
      - Containerized
      - InteractiveShell
      - pty

  condition: >
    web_service_parent
    and (
      spawned_shell_or_interpreter
      or interpreter_to_shell_chain
    )
    and suspicious_commandline
    and container_or_interactive_context

falsepositives:
  - Legitimate administrative access inside containers for debugging
  - Automated health checks or maintenance scripts (rare)
  - Red team or penetration testing activity

level: critical

tags:
  - attack.execution
  - attack.command_and_control
  - attack.discovery
  - attack.privilege_escalation
  - attack.t1059.006
  - attack.t1071.001
  - attack.t1033
  - attack.t1082
  - attack.t1611
  - azure
  - container
  - vm
