title: Azure ARM Control Plane Enumeration via Managed Identity
id: 2f6c8a91-5b3d-4e12-9e42-azure-arm-enumeration-managed-identity
status: experimental
description: >
  Detects Azure Resource Manager (ARM) control-plane discovery activity
  performed using a Managed Identity. The rule identifies successful
  read-oriented ARM operations commonly used for reconnaissance, such as
  role assignment enumeration and resource metadata listing. This behavior,
  especially when performed shortly after IMDS token issuance, is indicative
  of post-compromise privilege and resource discovery.

author: Cloud Threat Hunting / Purple Team
date: 2026-01-08

references:
  - https://attack.mitre.org/techniques/T1087/004/
  - https://attack.mitre.org/techniques/T1526/
  - https://attack.mitre.org/techniques/T1069/003/
  - https://learn.microsoft.com/azure/azure-resource-manager/management/overview
  - https://learn.microsoft.com/azure/role-based-access-control/role-assignments-list

logsource:
  product: azure
  service: azureactivity
  category: administrative

detection:

  # Successful ARM control-plane operations
  arm_success:
    ActivityStatus: Succeeded
    Category: Administrative

  # Read-only or discovery-oriented ARM actions
  arm_discovery_operations:
    OperationNameValue|contains:
      - "/read"
      - "list"
      - "providers"
      - "roleAssignments"
      - "storageAccounts"
      - "subscriptions"

  # Managed Identity context (non-human identity)
  managed_identity_context:
    Claims_d.idtyp: managedIdentity

  # ARM audience token usage
  arm_token_audience:
    Claims_d.aud|contains:
      - management.azure.com

  # Scope commonly targeted during reconnaissance
  broad_scope_access:
    Authorization_d.scope|contains:
      - "/subscriptions/"
      - "/providers/"

  condition: >
    arm_success
    and arm_discovery_operations
    and managed_identity_context
    and arm_token_audience
    and broad_scope_access

falsepositives:
  - Legitimate automation using managed identities for inventory or compliance
  - Infrastructure-as-code tooling performing read operations
  - Cloud governance or security posture management solutions

level: high

tags:
  - attack.discovery
  - attack.credential_access
  - attack.t1087.004
  - attack.t1069.003
  - attack.t1526
  - azure
  - arm
  - managed_identity
