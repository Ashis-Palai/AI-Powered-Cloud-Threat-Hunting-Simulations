title: AWS Workload Suspicious External Communication and C2 Beaconing
id: aws-workload-suspicious-external-c2
status: experimental
description: >
  Detects workloads communicating externally in patterns indicative of command-and-control (C2) activity,
  correlating GuardDuty C2 findings with VPC Flow Logs showing repeated outbound connections
  to uncommon ports, rare destinations, or known malicious infrastructure.

author: threat-hunting-lab
date: 2026-01-06
confidence: high

tags:
  - attack.command_and_control
  - attack.t1071.001
  - attack.t1095
  - attack.t1041
  - attack.cloud
  - aws.guardduty
  - aws.vpcflowlogs

logsource:
  product: aws
  service: GuardDuty EC2 & VPC Flow 

detection:

  guardduty_c2:
    service.serviceName: GuardDuty
    type:
      - Backdoor:EC2/C&CActivity
      - Backdoor:Runtime/C&CActivity
    service.action.actionType: NETWORK_CONNECTION
    service.action.networkConnectionAction.connectionDirection: OUTBOUND
    service.action.networkConnectionAction.blocked: false

  suspicious_flow:
    flow-direction: egress
    action: ACCEPT
    protocol: 6
    dstport:
      - 4444
      - 1337
      - 8081
      - 9001
      - 53
      - 22
    packets|gt: 5
    bytes|gt: 1000

  rare_destination:
    dstaddr|re: '^(?!10\.|172\.16\.|192\.168\.)'

  condition: guardduty_c2 or (suspicious_flow and rare_destination)

falsepositives:
  - Legitimate outbound connections to external services (CDNs, APIs)
  - Penetration testing or red-team simulations
  - Bastion or proxy hosts with expected external traffic

level: high
