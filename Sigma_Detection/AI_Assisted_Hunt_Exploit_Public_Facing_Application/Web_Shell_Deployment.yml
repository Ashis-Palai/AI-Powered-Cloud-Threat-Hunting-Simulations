title: AWS WAF Suspicious File Upload Indicative of Web Shell Deployment
id: a8f4c9e2-7c91-4f1a-9d3f-waf-webshell-upload
status: experimental
description: >
  Detects potential exploitation of a public-facing application via
  suspicious file upload behavior observed in AWS WAF logs. The rule
  focuses on executable file uploads, suspicious request parameters,
  and programmatic user agents commonly associated with web shell
  deployment and post-exploitation persistence.

author: Cloud Threat Hunting
date: 2026-01-06
references:
  - https://attack.mitre.org/techniques/T1190/
  - https://attack.mitre.org/techniques/T1505/003/
  - https://docs.aws.amazon.com/waf/latest/developerguide/waf-logging.html

logsource:
  product: aws
  service: waf

detection:
  http_method_upload:
    httpMethod:
      - POST
      - PUT

  suspicious_uri:
    uri|contains:
      - upload
      - file
      - attachment
      - .php
      - .jsp
      - .asp
      - .aspx
      - .war

  suspicious_args:
    args|contains:
      - file
      - upload
      - name=
      - .php
      - .phtml
      - .phar
      - .jsp
      - .asp
      - .aspx
      - .war
      - .zip
      - .tar
      - .gz

  programmatic_user_agent:
    headers|contains:
      - curl
      - wget
      - python
      - httpclient

  waf_indicators:
    labels|contains:
      - FileUpload
      - WebShell

  condition: >
    http_method_upload
    and suspicious_uri
    and suspicious_args
    and programmatic_user_agent

falsepositives:
  - Legitimate API-based file uploads using automation
  - Developer testing with command-line HTTP clients
  - CI/CD pipelines interacting with upload endpoints

level: high

tags:
  - attack.initial_access
  - attack.persistence
  - attack.t1190
  - attack.t1505.003
